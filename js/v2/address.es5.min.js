"use strict";function Alert(n){$(".cover").find("p").html(n);$(".cover").fadeIn(function(){$(document).one("click",".FaileSure,.coverClose",function(){$(".cover").fadeOut()})})}function isEmail(n){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(n)}function insertAddress(){var n={token:Cookies.get("TOKEN"),CountryId:object.countryID,Mobile:$("#mobile").val(),Email:$("#email").val(),ShipName:$("#receiver").val(),AddrDetail:$("#address1").val(),AddrDetail1:$("#address2").val(),StateName:$("#stateOrProvince").val(),CityName:$("#city").val(),IsDefault:1,AddrType:object.countryID==1?"1":"2",RegionCode:$(".numCode").val(),PostCode:$("#zipCode").val(),countryName:$("#country").val()};$.ajax({type:"POST",url:MomentCam.urls.insertAddressUrl,data:n,dataType:"json",success:function(t){if(console.info("insertAddress data:",t),null!=t)if(0==t.StatusCode){n.AddrId=t.AddrId;renderAddressDIV(n,!0);$(".boxAddress").length>2&&$(".boxAddress").eq(1).nextAll(".boxAddress").hide();Cookies.set("address",$("#address1").val()+$("#city").val()+$("#stateOrProvince").val());Cookies.set("mobile",$("#mobile").val());Cookies.set("zipCode",$("#zipCode").val());Cookies.set("receiver",$("#receiver").val());Cookies.set("email",$("#email").val());$(".addAddress").slideUp(300).find("input").val("");saveConsignee();$(".boxAddress").unbind("click").on("click",function(){$(this).hasClass("active")||($(this).addClass("active").siblings().removeClass("active"),Cookies.set("email",$(this).find(".address").attr("email")),Cookies.set("address",$(this).find(".address").html()),Cookies.set("mobile",$(this).find(".mobileNumber").html()),Cookies.set("zipCode",$(this).find(".address").attr("zipCode")),Cookies.set("receiver",$(this).find(".name").html()),saveConsignee())})}else alert(t.Description)},error:function(n,t){console.error("insertAddress textStatus:",t);alert("系统错误，请稍后重试")}}).always(function(){stop=!0})}function renderAddressDIV(n){var t='<div class="box boxAddress active" id="'+n.AddrId+'"><div class="box-left"><span class="name" email="'+n.Email+'">'+n.ShipName+'<\/span><span class="mobileNumber">'+n.RegionCode+" "+n.Mobile+'<\/span><span class="address" zipCode="'+n.PostCode+'">'+n.AddrDetail+","+n.AddrDetail1+","+n.CityName+","+n.StateName+'<\/span><span class="PostCode">'+n.PostCode+'<\/span><\/div><p class="country">'+n.countryName+'<\/p><div class="default"><\/p><\/div>';$(".boxAddress").each(function(){$(this).removeClass("active")});$(".boxCreat").after(t)}function addressDiv(){}function GetContryList(){jQuery.ajax({type:"post",async:!0,url:MomentCam.urls.GetAllRegionCode,data:"Language=en",cache:!1,beforeSend:function(n){n.setRequestHeader("EncryptType","NONE")},success:function(n){for(var r,u,t,f="",e="",i=0;i<DeliveryArea.length;i++){for(r="",u="",t=0;t<n.Regions.length;t++)DeliveryArea[i]==n.Regions[t].Id&&(r=n.Regions[t].Name,u=n.Regions[t].RegionCode);f+='<option class="sort_list" countryId="'+DeliveryArea[i]+'" name="'+r+'" code="'+u+'">'+r+"<\/option>";e+='<option class="code_list" countryId="'+DeliveryArea[i]+'" name="'+r+'" code="'+u+'">'+u+"<\/option>"}$("#country").html(f);$(".numCode").html(e);$(".sort_list[countryId='40']").attr("selected","selected");$(".code_list[code='+1']").attr("selected","selected");Cookies.set("country",$("#country").val());Cookies.set("countryID",$(".numCode").val());object.countryID=$(".sort_list:checked").attr("countryId");$("#country").change(function(){object.countryID=$(".sort_list:checked").attr("countryId");object.code=$(".sort_list:checked").attr("code");object.countryName=$(".sort_list:checked").attr("name");Cookies.set("country",object.countryName);Cookies.set("countryID",$(".numCode").val());$(".numCode").val(object.code)});$(".numCode").change(function(){object.countryID=$(".code_list:checked").attr("countryId");object.code=$(".code_list:checked").attr("code");object.countryName=$(".code_list:checked").attr("name");$("#country").val(object.countryName);Cookies.set("country",object.countryName);Cookies.set("countryID",$(".numCode").val())})},error:function(n){throw n.message;}})}function saveConsignee(){var n=$(".boxAddress.active").attr("id"),t;console.info("addrId",n);t={Token:Cookies.get("TOKEN"),ProductId:Cookies.get("FinalProductId"),ProductCount:parseInt($(".CountNum").html()),AddrId:n,DeviceId:"12332ds456"};$.ajax({type:"POST",url:MomentCam.urls.saveConsignee,data:t,dataType:"json",success:function(n){console.info(n);n.StatusCode==0?($(".shippingFee .price").html("$"+n.Orders[0].ShippingFee),$(".totalPrice span").eq(1).html("$"+n.PayableAmount.toFixed(2))):alert(n.Description)},error:function(n,t){console.error("updateAddress textStatus:",t)}}).always(function(){})}var DeliveryArea=[4658,4661,8,4668,4673,4674,4681,4683,4687,28,4691,4702,4706,4708,4713,4717,4720,4723,4724,4729,4732,4744,4745,4746,70,71,4749,4752,50,4762,4767,4768,4769,4770,4771,39,4776,4782,4783,4784,4793,4795,4803,4812,4813,4814,4819,20,4826,4830,65,4834,4835,25,4840,4846,4847,4849,56,4865,4867,40,73],object={},stop=!0,Address;$(function(){$(".boxCreat").unbind("click").on("click",function(){$(".addAddress").slideDown(300);GetContryList()});$(".addAddress_cancel").unbind("click").on("click",function(){$(".addAddress").slideUp(300)});$(".addAddress_save").on("click",function(){stop&&Address.CheckForm()&&(insertAddress(),stop=!1)})});Address={GetAddressList:function(){jQuery.ajax({type:"post",async:!0,url:MomentCam.urls.getAllAdressUrl,data:"Language=en&token="+Cookies.get("TOKEN"),cache:!1,beforeSend:function(n){n.setRequestHeader("EncryptType","NONE")},success:function(n){var i,t,r;if(n.StatusCode==0){if(n.AddrList.length==0){$(".addAddress").show();GetContryList();return}for(i=0;i<n.AddrList.length;i++)t=n.AddrList[i],r={AddrId:t.AddrId,CountryId:t.CountryId,Mobile:t.Mobile,Email:t.Email,ShipName:t.ShipName,AddrDetail:t.AddrDetail,AddrDetail1:t.AddrDetail1,StateName:t.StateName,CityName:t.IntlCityName,IsDefault:1,AddrType:t.CountryId,RegionCode:t.RegionCode,PostCode:t.PostCode,countryName:t.CountryName},renderAddressDIV(r);$(".addressBox").append("<div class='showAll'>more address<div class='tu'><\/div><\/div>");$(".boxAddress").unbind("click").on("click",function(){$(this).addClass("active").siblings().removeClass("active");Cookies.set("email",$(this).find(".address").attr("email"));Cookies.set("address",$(this).find(".address").html());Cookies.set("mobile",$(this).find(".mobileNumber").html());Cookies.set("zipCode",$(this).find(".address").attr("zipCode"));Cookies.set("receiver",$(this).find(".name").html());saveConsignee()});$(".boxAddress").length>2?($(".boxAddress").eq(1).nextAll(".boxAddress").hide(),$(".showAll").show()):$(".showAll").hide();$(".showAll").on("click",function(){$(".boxAddress").length>2&&($(this).hasClass("a")?($(".boxAddress").eq(1).nextAll(".boxAddress").hide(),$(this).removeClass("a"),$(".showAll").html("more address<div class='tu'><\/div>"),$(".tu").css("background-image","url('https://mall-res.momentcam.net/Images/mo/Order/order_address_number_down.png')")):($(".boxAddress").eq(1).nextAll(".boxAddress").show(),$(this).addClass("a"),$(".showAll").html("pack up<div class='tu'><\/div>"),$(".tu").css("background-image","url('https://mall-res.momentcam.net/Images/mo/Order/order_address_number_up.png')")))})}},error:function(n){throw n.message;}})},CheckForm:function(){var n=!0;return $(".addAddress input[required]").each(function(){if(this.value.trim()=="")return Alert("Please add delivery address."),n=!1}),n}};