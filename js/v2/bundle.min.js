function GetUploadImage(n,t,i){function s(n,t){if(!n)return t(-1);var i=new FileReader;i.onload=function(n){var r=new DataView(n.target.result),o,i,e,u,s,f;if(r.getUint16(0,!1)!=65496)return t(-2);for(o=r.byteLength,i=2;i<o;)if(e=r.getUint16(i,!1),i+=2,e==65505){if(r.getUint32(i+=2,!1)!=1165519206)return t(-1);for(u=r.getUint16(i+=6,!1)==18761,i+=r.getUint32(i+4,u),s=r.getUint16(i,u),i+=2,f=0;f<s;f++)if(r.getUint16(i+f*12,u)==274)return t(r.getUint16(i+f*12+8,u))}else if((e&65280)!=65280)break;else i+=r.getUint16(i,!1);return t(-1)};i.readAsArrayBuffer(n)}var e=new Image,u=null,f=null,r,o;t=="upload"?(window.URL=window.URL||window.webkitURL,e.src=window.URL.createObjectURL(n),u=document.getElementById("canvas")):(u=document.getElementById("canvasCemara"),e.src=u.toDataURL("image/png"));f=u.getContext("2d");r=new Image;r.src=e.src;o=this;r.onload=function(){s(n,function(n){var e=700,t=document.createElement("canvas"),h=t.getContext("2d"),c,s,v,o;r.width>=r.height&&r.width>e?(t.width=e,t.height=e*r.height/r.width,t.height=t.height+(4-(t.height%4==0?4:t.height%4))):r.width<r.height&&r.height>e?(t.height=e,t.width=e*r.width/r.height,t.width=t.width+(4-(t.width%4==0?4:t.width%4))):(t.width=r.width+(4-(r.width%4==0?4:r.width%4)),t.height=r.height+(4-(r.height%4==0?4:r.height%4)));h.drawImage(r,0,0,t.width,t.height);h.drawImage(t,0,0,t.width,t.height);u.width=t.width;u.height=t.height;n==8||n==6||n==3?(f.save(),n==8||n==6?(u.width=t.height,u.height=t.width,n==6?f.translate(t.height,0):f.translate(0,t.width)):n==3?f.translate(t.width,t.height):f.translate(t.width,0),c=n==8?-90:n==3?-180:90,f.rotate(c*(Math.PI/180)),n==3?f.drawImage(t,0,0,t.width,t.height,0,0,u.width,u.height):f.drawImage(t,0,0,t.width,t.height,0,0,u.height,u.width),f.restore()):f.drawImage(t,0,0,t.width,t.height,0,0,u.width,u.height);var y=u.toDataURL("image/jpeg"),l=atob(y.split(",")[1]),a=[];for(s=0;s<l.length;s++)a.push(l.charCodeAt(s));v=new Blob([new Uint8Array(a)],{type:"image/jpeg"});o=new FormData;o.append("file",v);o.append("FilePurpose","Photo");o.append("filename","file.jpeg");$.ajax({type:"post",url:"https://imgupload.momentcam.net/api/Image/Upload",data:o,timeout:2e4,success:function(n){return i(n)},error:function(n){return i(n)},processData:!1,contentType:!1})})}}function changeBtn(n,t,i){n==" tru"&&t=="true"?(i.siblings(".swiper-button-prev").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_disabled.png)","background-size":"cover"}),i.siblings(".swiper-button-next").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_disabled.png)","background-size":"cover"})):n==" tru"&&t!="true"?(i.siblings(".swiper-button-prev").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_disabled.png)","background-size":"cover"}),i.siblings(".swiper-button-next").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_normal.png)","background-size":"cover"})):n!=" tru"&&t=="true"?(i.siblings(".swiper-button-prev").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_normal.png)","background-size":"cover"}),i.siblings(".swiper-button-next").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_disabled.png)","background-size":"cover"})):n!=" tru"&&t!="true"&&(i.siblings(".swiper-button-prev").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_normal.png)","background-size":"cover"}),i.siblings(".swiper-button-next").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_normal.png)","background-size":"cover"}))}function changeBtns(n,t,i){n==" tru"&&t=="true"?(i.parent().siblings(".swiper-button-prev").css("background-image","url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_disabled.png)"),i.parent().siblings(".swiper-button-next").css("background-image","url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_disabled.png)")):n==" tru"&&t!="true"?(i.parent().siblings(".swiper-button-prev").css("background-image","url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_disabled.png)"),i.parent().siblings(".swiper-button-next").css("background-image","url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_normal.png)")):n!=" tru"&&t=="true"?(i.parent().siblings(".swiper-button-prev").css("background-image","url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_normal.png)"),i.parent().siblings(".swiper-button-next").css("background-image","url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_disabled.png)")):n!=" tru"&&t!="true"&&(i.parent().siblings(".swiper-button-prev").css("background-image","url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_normal.png)"),i.parent().siblings(".swiper-button-next").css("background-image","url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_normal.png)"))}function checkInView(n,t,i){var u=i.width(),e=i.scrollLeft(),h=e+u,r=$(n).offset().left-i.offset().left,f=r+$(n).width(),o=r>=0&&f<=u,s=(r<0&&f>0||r>0&&r<=i.width())&&t;return o||s}function generateUUID(){var n=(new Date).getTime();return typeof performance!="undefined"&&typeof performance.now=="function"&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(t==="x"?i:i&3|8).toString(16)})}function getSkuProductBySelectedProps(n){return $.grep(Parameters.SkuProduct,function(t){var i=$.grep(n,function(n){return getProductPropValue(t,n.PropCode)!=n.PropValueId});return i.length==0&&t.ProductStock>0})}function getProductPropValue(n,t){var i=null;return $(n.SkuProps).each(function(){this.PropCode==t&&(i=this.PropValueId)}),i}function comicButtonEvent(){if(Parameters.clickCheck&&!$(this).hasClass("active")){Parameters.clickCheck=!1;$(this).addClass("active").parent().siblings().find("img").removeClass("active");var n=$(this).attr("id");n&&(Parameters.BGID=n);Parameters.isRenderProduct?CarouseFigureMask(Parameters.MaskResult):GoRender(Parameters.BGID,function(){Parameters.clickCheck=!0})}}function CarouseFigureMask(n,t){function e(n){for(var r,t=[],i=0;i<n.length;i++)r=n[i].split(","),t.push(Number(r[0])),t.push(Number(r[1]));return t}var f,r,i,u;if(Parameters.clickCheck=!1,f=this,POP.StartLoading(),$(".ComicShow").addClass("NoBorder"),Parameters.bgSaver[n.Product.BannerImages[0].BkgdImg]&&!t&&Parameters.bgSaver[n.Product.BannerImages[0].BkgdImg][Parameters.BGID]!=undefined){r=Parameters.bgSaver[n.Product.BannerImages[0].BkgdImg][Parameters.BGID];$("[name='renderResult']").attr("src",r).hide().fadeIn(300);$(".CoverMask").hide();POP.CloseLoading();$(".Buy span").eq(0).html("$"+n.Product.SalePrice).show();Parameters.clickCheck=!0;return}i={};i.EmbedImageUrl="";i.BackImageUrl=n.Product.BannerImages[0].BkgdImg;i.MaskImageUrl=n.Product.BannerImages[0].ImagePath;u=JSON.stringify(e(n.Product.BannerImages[0].LocationPoints));i.P4=JSON.parse(u);i.BackgroundName=Parameters.BGID+"02";i.Heads=[];i.Heads.push({Key:Parameters.FACEUID,Value:0});Parameters.Heads=i.Heads;i.GrayStyle=1;i.ImageFormatType=0;jQuery.ajax({type:"post",async:!0,url:MomentCam.urls.carouseFigureMaskUrl,timeout:25e3,cache:!1,data:"json="+JSON.stringify(i),success:function(n){n=JSON.parse(n);n.Path=n.Path.replace("square-ali.manboker.com","square.oss-cn-hangzhou.aliyuncs.com").replace("production-us.manboker.com","moman-production-us.oss-us-west-1.aliyuncs.com");Parameters.bgSaver[i.BackImageUrl]||(Parameters.bgSaver[i.BackImageUrl]={});Parameters.link=n.Path;n.Path=n.Path+Parameters.RenderPrefix+"/resize,w_550";Parameters.bgSaver[i.BackImageUrl][Parameters.BGID]=n.Path;Parameters.Thumb=n.Path;loadImage(n.Path,function(){$("[name='renderResult']").attr("src",n.Path).hide().fadeIn(300);Parameters.isRenderProduct?$(".ComicShow").addClass("NoBorder"):$(".ComicShow").removeClass("NoBorder");$(".CoverMask").hide();POP.CloseLoading();Parameters.clickCheck=!0})},error:function(){}})}function GoRender(n,t){var r=this,i;if($(".specList").html("").hide(),$(".Btns").find(".Buy").hide().end().find(".Share").css("float","none").css("background-repeat","no-repeat").css("margin","0 auto"),n&&Parameters.RenderSaver[n])return(Parameters.clickCheck=!0,Parameters.link=Parameters.RenderSaver[n].Path,$("[name='renderResult']").attr("src",Parameters.RenderSaver[n].Path.replace("http:","https:")),$(".CoverMask").hide(),POP.CloseLoading(),t)?t(""):void 0;Parameters.RenderSaver[n]={};POP.StartLoading();i={};n?(Parameters.BGID=n,i.BackgroundName=n+"02"):i.BackgroundName=Parameters.Gender==1?Parameters.maleBG:Parameters.femaleBG;i.Heads=[];i.Heads.push({Key:Parameters.FACEUID,Value:0});Parameters.Heads=i.Heads;i.GrayStyle=1;i.AddWaterMark="1";i.WaterMarkUrl="https://mall-res.momentcam.net/Images/watermark.png";i.ImageFormatType=MomentCam.config.isSupportWebp?2:2;CallAjax(MomentCam.urls.serverRender,"json="+JSON.stringify(i),function(i){i.Path=i.Path.replace("square-ali.manboker.com","square.oss-cn-hangzhou.aliyuncs.com").replace("production-us.manboker.com","moman-production-us.oss-us-west-1.aliyuncs.com");i.Path=i.Path+Parameters.RenderPrefix+"/resize,w_550";loadImage(i.Path,function(){return Parameters.clickCheck=!0,Parameters.RenderSaver[n].Path=i.Path,Parameters.link=i.Path,$(".ComicShow").removeClass("NoBorder"),$("[name='renderResult']").attr("src",i.Path.replace("http:","https:")).hide().fadeIn(300),$(".CoverMask").hide(),POP.CloseLoading(),t?t(""):void 0})})}var Coupon,ProductHandler;(function(){function u(n,t,i){function u(n,t,i){t=="hair"&&(i=Parameters.hairColor+i.substr(3,i.length));Parameters.AttachData.push({Type:""+n+"",PositionType:""+t+"",ResourceID:""+i+"",m11:"1",m21:"0",dx:"0",m12:"0",m22:"1",dy:t=="beard"?"-70":Parameters.dy})}var e=this;f(i);u(t,i,n);r()}function f(n,t){var u,i,f;for(POP.StartLoading(),u=n,i=0;i<Parameters.AttachData.length;i++)f=Parameters.AttachData[i].PositionType,f===u&&Parameters.AttachData.splice(i,1);t&&r()}function c(t,i){var r={};r.localtime="";r.test="";r.language="zh";r.fromtype=n.config.needRemoveItems.indexOf(t)!=-1?"android":"h5";r.appversion="1";r.dateversion=0;r.themeid=t;r.coreid=5;jQuery.ajax({type:"post",async:!0,url:MomentCam.urls.getresourceUrl,timeout:25e3,cache:!1,data:"language=en&fromtype=h5&appversion=76&extend="+JSON.stringify(r),success:function(n){try{return i(JSON.parse(n))}catch(t){return i("")}}})}function e(n){var i=this;n==2&&(l(),h(),t("376","top",{type:"10",id:"376",name:"hair"}),t("375","bottom",{type:"7",id:"375",name:"face"}))}function t(n,t,i){t=="top"?$("#topAssetsContainer").empty():$("#bottomAssetsContainer").empty();Parameters.themeID=n;Parameters.SwiperObject[n]!=null?o(Parameters.SwiperObject[n],n,t,i):Parameters.SwiperObject[n]==null&&c(n,function(r){Parameters.SwiperObject[n]=r;o(r,n,t,i)})}function o(t,r,e,o){var w,a,y,l,t,b,k,d,g;try{Parameters.swiperObj[e]&&(Parameters.swiperObj[e].setWrapperTranslate(0),Parameters.swiperObj[e].destroy());var nt=this,v=[],h=[],p="",c=e=="top"?$("#topAssetsContainer"):$("#bottomAssetsContainer");for(l=0;l<t.ResourceLst.length;l++)(imgPath=t.ResourceLst[l].ICOPath,w=imgPath.substr(imgPath.lastIndexOf("/")+4,1),n.config.needRemoveItems.indexOf(r)!=-1||w==Parameters.Gender)&&(h.push(t.ResourceLst[l].Name),imgPath=n.config.ImagePrefix+t.ResourceLst[l].ICOPath,v.push(imgPath));for(o.name=="hair"&&(a=Parameters.assetsSaver.hair.name.replace("055","054").slice(0,-2),h.indexOf(a)==-1?h.unshift(a):(y=h.indexOf(a),h.splice(y,1),v.splice(y,1),h.unshift(a)),v.unshift(n.config.ImagePrefix+"Images/MomentCamColorV3/hair_icon/"+a+"03")),o.name=="face"&&(a=Parameters.assetsSaver.face.name.slice(0,-2),h.indexOf(a)==-1?h.unshift(a):(y=h.indexOf(a),h.splice(y,1),v.splice(y,1),h.unshift(a)),v.unshift(n.config.ImagePrefix+"Images/MomentCamColorV3/face/"+a+"03")),h=h.filter(function(n,t){return h.indexOf(n)==t}),v=v.filter(function(n,t){return v.indexOf(n)==t}),l=0;l<v.length;l++)if(l==0&&n.config.needRemoveItems.indexOf(r)!=-1)p+='<div class="iconWrapper"><img src="https://mall-res.momentcam.net/Images/mo/Beauty/makeup_icon_cancel.png"  class="cancel"/><\/div>';else{if(l+1>v.length)break;p+='<div class="iconWrapper"><img src="'+v[l]+'" id="'+h[l]+'"/><\/div>'}c.append('<div class="swiper-slide">'+p+"<\/div>");t="";b="";$.each(c.find(".iconWrapper"),function(n,r){t+=" "+i($(r),!1,c);b+=" "+i($(r),!0,c)});k=t.substr(0,4);d=t.substr(t.length-4);s(k,d,c);c.scroll(function(){var n="",u="",t,r;$.each(c.find(".iconWrapper"),function(t,r){n+=" "+i($(r),!1,c);u+=" "+i($(r),!0,c)});t=n.substr(0,4);r=n.substr(n.length-4);s(t,r,c)});c.attr("data-name",o.name);c.attr("data-id",o.id);c.attr("data-type",o.type);Parameters.iconActiveSaver[o.name]&&Parameters.iconActiveSaver[o.name].active?(g=Parameters.iconActiveSaver[o.name].active,c.find(".swiper-slide #"+g).addClass("active")):c.find(".swiper-slide .iconWrapper").find("img").eq(0).addClass("active")}catch(tt){}$(".iconContainer img").unbind("click").bind("click",function(){if(Parameters.clickCheck&&!$(this).hasClass("active")){if($(this).addClass("active").parent().siblings().find("img").removeClass("active"),Parameters.clickCheck=!1,$(this).hasClass("cancel")){f($(this).parent().parent().parent().attr("data-name"),!0);$(this).addClass("active").siblings().removeClass("active");return}$(this).addClass("active").siblings().removeClass("active");var n={};n.name=$(this).attr("id")+"02";n.typeID=$(this).parent().parent().parent().attr("data-type");n.typeName=$(this).parent().parent().parent().attr("data-name");Parameters.assetsSaver[n.typeName]=n;Parameters.selectSaver[r]=n.name;Parameters.iconActiveSaver[n.typeName]||(Parameters.iconActiveSaver[n.typeName]={});Parameters.iconActiveSaver[n.typeName].active||(Parameters.iconActiveSaver[n.typeName].active={});Parameters.iconActiveSaver[n.typeName].active=n.name.substr(0,n.name.length-2);u(n.name,n.typeID,n.typeName)}})}function l(){for(var t=this,n=0;n<MomentCam.skinSetting.comicSkinColors.length;n++)Parameters.Gender==1?Parameters.skinArr.push(MomentCam.skinSetting.comicSkinColors[n].genderColors.maleColor):Parameters.skinArr.push(MomentCam.skinSetting.comicSkinColors[n].genderColors.femaleColor)}function s(n,t,i){n==" tru"&&t=="true"?(i.parent().siblings(".swiper-button-prev").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_disabled.png?v=233)","background-size":"cover"}),i.parent().siblings(".swiper-button-next").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_disabled.png?v=233)","background-size":"cover"})):n==" tru"&&t!="true"?(i.parent().siblings(".swiper-button-prev").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_disabled.png?v=233)","background-size":"cover"}),i.parent().siblings(".swiper-button-next").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_normal.png?v=233)","background-size":"cover"})):n!=" tru"&&t=="true"?(i.parent().siblings(".swiper-button-prev").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_normal.png?v=233)","background-size":"cover"}),i.parent().siblings(".swiper-button-next").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_disabled.png?v=233)","background-size":"cover"})):n!=" tru"&&t!="true"&&(i.parent().siblings(".swiper-button-prev").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_left_normal.png?v=233)","background-size":"cover"}),i.parent().siblings(".swiper-button-next").css({"background-image":"url(https://mall-res.momentcam.net/Images/mo/v2/beauty/beauty_makeup_right_normal.png?v=233)","background-size":"cover"}))}function h(n){POP.StartLoading();n||(n=0);var t=this;CallAjax(MomentCam.urls.updateSkinColorsURL,"faceuid="+Parameters.FACEUID+"&json="+JSON.stringify(Parameters.skinArr[n]),function(){r()})}function r(){Parameters.RenderSaver={};var t={};t.Attachments=Parameters.AttachData;CallAjax(MomentCam.urls.updataMakeUpUrl,"faceuid="+Parameters.FACEUID+'&json="'+JSON.stringify(t),function(){Parameters.isRenderProduct?CarouseFigureMask(Parameters.MaskResult,!0):n.GoRender(Parameters.BGID,null)})}function i(n,t,i){var u=i.width(),e=i.scrollLeft(),h=e+u,r=$(n).offset().left-i.offset().left,f=r+$(n).width(),o=r>=0&&f<=u,s=(r<0&&f>0||r>0&&r<=i.width())&&t;return o||s}function a(){var n=this;$(".tab ul li").on("click",function(){var i,n;$(this).hasClass("active")||(i=$(this).hasClass("top")?$(".topPart "):$(".bottomPart"),i.find("li").each(function(){$(this).removeClass("active")}),$(this).addClass("active"),n=$(this).attr("data-id"),Parameters.currentDataName=$(this).attr("data-name"),Parameters.currentDataType=$(this).attr("data-type"),$(this).hasClass("top")?t(n,"top",{type:$(this).attr("data-type"),id:$(this).attr("data-id"),name:$(this).attr("data-name")}):t(n,"bottom",{type:$(this).attr("data-type"),id:$(this).attr("data-id"),name:$(this).attr("data-name")}))});$(".buttonGroup .a").on("click",function(n){n.preventDefault();window.location.href="selectItem.html?v="+Math.random()});$(".swiper-button-next").on("click",function(){$($(this).parent().find(".swiper-wrapper")).animate({scrollLeft:"+=650"},500,function(){})});$(".swiper-button-prev").on("click",function(){$($(this).parent().find(".swiper-wrapper")).animate({scrollLeft:"-=650"},500,function(){})});$(".resetGroup .b").on("click",function(){window.location.href="upload.html?v="+Math.random()});$(".fairColor").on("click",function(){var n=$(this).find("img").attr("src"),t;n.indexOf("click")>0||!Parameters.clickCheck||($(this).parent().find(".fairColor").each(function(){$(this).find("img").attr("src",$(this).find("img").attr("src").replace("_click.png",".png"))}),Parameters.clickCheck=!1,$(this).find("img").attr("src",n.replace(".png","_click.png")),$(this).parent().attr("id")=="hairColor"?(Parameters.hairColor=$(this).attr("data-id"),u(Parameters.assetsSaver.hair.name,Parameters.assetsSaver.hair.typeID,Parameters.assetsSaver.hair.typeName)):$("#skinColor").css("display")=="inline-block"&&(t=$(this).index(),h(t)))})}var n={config:{ImagePrefix:"https://mall-res.momentcam.net/",needRemoveItems:["205","206","207","186","187"]},init:function(){Parameters.Gender==2?$(".tab .beard").remove():$(".tab .eyes").remove();a();this.InitHead()},InitHead:function(){var n=0,t=Parameters.offset-0,i;t>30&&(t=30);Parameters.dy=-220+t;Parameters.AttachData.push({Type:"11",PositionType:"head",ResourceID:"",m11:"1",m21:"0",dx:"0",m12:"0",m22:"1",dy:"-220"});i="faceuid="+Parameters.FACEUID+"&isfemale="+(Parameters.Gender==1?"false":"true");CallAjax(MomentCam.urls.HairStyleMatchUrl,i,function(t){n++;Parameters.AttachData.push({Type:"10",PositionType:"hair",ResourceID:""+t.Results[0].replace("055","057")+"",m11:"1",m21:"0",dx:"0",m12:"0",m22:"1",dy:""+Parameters.dy+""});var i={};i.name=t.Results[0];i.typeID="10";i.typeName="hair";Parameters.assetsSaver.hair=i;e(n,376)});CallAjax(MomentCam.urls.FaceShapeMatchUrl,i,function(t){n++;Parameters.AttachData.push({Type:"7",PositionType:"face",ResourceID:""+t.Results[0].replace("016","041")+"",m11:"1",m21:"0",dx:"0",m12:"0",m22:"1",dy:""+Parameters.dy+""});var i={};i.name=t.Results[0];i.typeID="7";i.typeName="face";Parameters.assetsSaver.face=i;e(n,375)})},GoRender:function(n,t){var r=this,i;if($(".specList").html("").hide(),$(".Btns").find(".Buy").hide().end().find(".Share").css("float","none").css("background-repeat","no-repeat").css("margin","0 auto"),n&&Parameters.RenderSaver[n])return(Parameters.clickCheck=!0,Parameters.link=Parameters.RenderSaver[n].Path,$("[name='renderResult']").attr("src",(Parameters.RenderSaver[n].Path+Parameters.RenderPrefix).replace("http:","https:")),$(".CoverMask").hide(),POP.CloseLoading(),t)?t(""):void 0;Parameters.RenderSaver[n]={};POP.StartLoading();i={};n?(Parameters.BGID=n,i.BackgroundName=n+"02"):i.BackgroundName=Parameters.Gender==1?Parameters.maleBG:Parameters.femaleBG;i.Heads=[];i.Heads.push({Key:Parameters.FACEUID,Value:0});Parameters.Heads=i.Heads;i.GrayStyle=1;i.AddWaterMark="1";i.ImageFormatType=MomentCam.config.isSupportWebp?2:2;CallAjax(MomentCam.urls.serverRender,"json="+JSON.stringify(i),function(i){i.Path=i.Path.replace("square-ali.manboker.com","square.oss-cn-hangzhou.aliyuncs.com").replace("production-us.manboker.com","moman-production-us.oss-us-west-1.aliyuncs.com");loadImage(i.Path+Parameters.RenderPrefix,function(){return Parameters.clickCheck=!0,Parameters.RenderSaver[n].Path=i.Path,Parameters.link=i.Path,$(".ComicShow").removeClass("NoBorder"),$("[name='renderResult']").attr("src",(i.Path+Parameters.RenderPrefix).replace("http:","https:")).hide().fadeIn(300),$(".CoverMask").hide(),POP.CloseLoading(),t?t(""):void 0})})}};window.B=n})(window);Coupon={init:function(){this.Coupon()},Coupon:function(){if(!$(".Code input").val()){Alert("Coupon code is empty");return}var i=this,n=Cookies.get("FinalProductId"),t={Token:Cookies.get("TOKEN"),ProductId:n,ProductCount:parseInt($(".CountNum").html()),DeviceId:generateUUID(),CouponCode:$(".Code input").val()};n==MomentCam.urls.VirtualID?(Parameters.digitalCoupon=$(".Code input").val(),CallAjax(MomentCam.urls.checkCoupon,"code="+Parameters.digitalCoupon,function(n){n.StatusCode==80008?(Parameters.virtualObj=null,ProductHandler.GetVirtualProduct(MomentCam.urls.VirtualIDWithC,!0)):Alert("Coupon number not avaliable")})):CallAjax(MomentCam.urls.saveCoupon,t,function(n){if(n.StatusCode==0){Parameters.ProductName=n.Orders[0].Products[0].ProductName;Parameters.ProductPrice=n.Orders[0].Products[0].SalePrice;$(".productName span").eq(0).html(Parameters.ProductName);$(".productName span").eq(1).html(n.Orders[0].Products[0].SellPropName);var t=n.Orders[0].Products[0];$(".rightPart span").eq(0).html("$"+t.SalePrice);$(".rightPart span").eq(1).html("x"+t.ProductCount);$(".rightPart span").eq(2).html("$"+t.SalePrice*t.ProductCount);$(".totalPrice .price").html("$"+(n.Orders[0].SalePriceTotal-0+n.Orders[0].ShippingFee).toFixed(2));$(".orderPrice .price").html("$"+n.Orders[0].SalePriceTotal);$(".shippingFee .price").html("$"+n.Orders[0].ShippingFee)}else Alert("There is a issue with coupon, please try again")})}},function(){function f(n){return $.grep(Parameters.SkuProduct,function(t){var i=$.grep(n,function(n){return e(t,n.PropCode)!=n.PropValueId});return i.length==0&&t.ProductStock>0})}function e(n,t){var i=null;return $(n.SkuProps).each(function(){this.PropCode==t&&(i=this.PropValueId)}),i}var t={},n,i=!1,u={Common:function(){t={FinalProductId:Cookies.get("FinalProductId"),isRenderProduct:Cookies.get("isRenderProduct"),userInfo:JSON.parse(Cookies.get("user")),ProductImg:Cookies.get("ProductImg")};$(".FromWho span").html(t.userInfo.NickName);$(".leftPart img#showGoodPic").attr("src",t.ProductImg).show();t.FinalProductId!=424&&t.FinalProductId!=444?(clickCheck=!0,Parameters.isRenderProduct=!0,r.GetProduct(t.FinalProductId)):(Parameters.FinalProductId=424,Parameters.isRenderProduct=!1,$(".add,.reduce").css({cursor:"not-allowed"}),$(".UnitPrices span").eq(1).html("$9.99"),$(".TotlePrices span").eq(1).html("$9.99"),$(".CountNums").attr("readonly","readonly"),$(".GoodNames").html("MomentCam Caricature (Digital)"))},Bind:function(){$(".CountNums").keyup(function(){this.value=this.value.replace(/[^\d]/g,"")}).change(function(){var t=Number($(".CountNums").val());console.log(Parameters.ProductStock);t>Parameters.ProductStock?t=Parameters.ProductStock:t<=0&&(t=1);$(".CountNums").val(t);$(".Amount span").eq(1).html("x"+t);$(".TotlePrices span").eq(1).html("$"+(Number(n.Product.SalePrice)*Number(t)).toFixed(2));Parameters.BuyCount=t});$(".add").on("click",function(){var t,i;Number($(".CountNums").val())!=1&&($(".add").css({cursor:"pointer"}),Parameters.BuyCount=Number($(".CountNums").val()),t=1,Parameters.ProductStock==0&&(t=0),Parameters.BuyCount<=t?Parameters.BuyCount=t:Parameters.BuyCount--,Parameters.BuyCount>1?$(".add").css({cursor:"pointer"}):$(".add").css({cursor:"not-allowed"}),$(".CountNums").val(Parameters.BuyCount),$(".Amount span").eq(1).html("x"+Parameters.BuyCount),i=0,i=n?n.Product.SalePrice:9.99,$(".TotlePrices span").eq(1).html("$"+(Number(i)*Number($(".CountNums").val())).toFixed(2)))});$(".reduce").on("click",function(){var t,i,r;Parameters.BuyCount=Number($(".CountNums").val());t=0;i="";n?Parameters.ProductStock>Parameters.LimitBuyCountPerOrder?(t=Parameters.LimitBuyCountPerOrder,i="每件商品限购"+t+"件"):(t=Parameters.ProductStock,i="资源紧张，库存不足！"):($(".add").css({cursor:"not-allowed"}),t=1);Parameters.BuyCount>=t?Parameters.BuyCount=t:Parameters.BuyCount++;Parameters.BuyCount>1&&n?($(".reduce").css({cursor:"pointer"}),$(".add").css({cursor:"pointer"})):$(".add").css({cursor:"not-allowed"});$(".CountNums").val(Parameters.BuyCount);$(".Amount span").eq(1).html("x"+Parameters.BuyCount);r=0;r=n?n.Product.SalePrice:9.99;$(".TotlePrices span").eq(1).html("$"+(Number(r)*Number($(".CountNums").val())).toFixed(2))});$(".GoPay").on("click",function(){Cookies.set("ProductCount",$(".CountNums").val());$(".rightPartHalf").hide();$(".nextPart").css("display","inline-block");$(".a").hide();$(".b").show();$(".AdressDetail").remove();$(".oLoading").hide();$(".AddressEditBox").trigger("click");Order.init()});$(".a").on("click",function(){window.parent.location.href="../index.html?name=chooseItem&v="+Math.random();window.parent.history.pushState(null,null,"Index.html?name=chooseItem")});$(".b").on("click",function(){$(".nextPart").hide();$(this).hide();$(".a").show();$(".rightPartHalf").css("display","inline-block")})},init:function(){this.Common();this.Bind()}},r;window.goOrder=u;r={GetProduct:function(t){if(Parameters.ProductSaver[t]){clickCheck=!1;this.FetchProduct(Parameters.ProductSaver[t]);return}var r=this,i={};i.Id=t;i.Language="zh";i.fromtype="pc";i.AppVersion="3.9";jQuery.ajax({type:"post",async:!0,dataType:"json",url:MomentCam.urls.getProductUrl,timeout:25e3,contentType:"application/json; charset=utf-8",cache:!1,data:JSON.stringify(i),success:function(i){console.log(i);Parameters.ProductSaver[t]=i;n=i;r.FetchProduct(i)}})},FetchProduct:function(t){function s(){var a,e,t,o,h,c,u,s;if(!$(this).hasClass("disabled")){for($(this).closest("ul").hide(),$(this).parent().siblings("span").html($(this).html()).attr("id",$(this).attr("id")).removeClass("active"),$(this).addClass("selected").siblings().removeClass("selected"),a=$(this).closest(".specModels").attr("propcode"),e=[],$(".specModels").each(function(){var n=$(this).find(".selected");n.length>0&&e.push({PropCode:$(this).attr("propcode"),PropValueId:n.attr("id")})}),$(".spec").each(function(){var t=$(this).find(".specModels"),n=t.attr("propcode");a!=n&&t.find("li").each(function(){var r,i,t;if($(this).removeClass("disabled"),r=$(this).attr("id"),!$(this).hasClass("selected")){for(i=[],t=0;t<e.length;t++)e[t].PropCode!=n&&i.push(e[t]);i.push({PropCode:n,PropValueId:r});f(i).length==0&&$(this).removeClass("selected").addClass("disabled")}})}),t=Parameters.SkuProduct[0].SkuProps,i=!0,u=0;u<t.length;u++)if(o=t[u].PropCode,h=$(".spec").find("[propcode='"+o+"']").find("li").hasClass("selected")?$(".spec").find("[propcode='"+o+"']").find("li.selected").attr("id"):undefined,!h){i=!1;break}if(i){for(c=[],u=0;u<t.length;u++){var o=t[u].PropCode,h=$(".spec").find("[propcode='"+o+"']").find("li").hasClass("selected")?$(".spec").find("[propcode='"+o+"']").find("li.selected").attr("id"):undefined,l={};l.name=t[u].PropCode;l.id=h;h&&c.push(l)}$(".GoPay").addClass("active");s=r.GetFinalProductId(c);s!=null&&s.ProductStock>0&&(Parameters.FinalProductId=s.ProductId,Cookies.set("FinalProductId",Parameters.FinalProductId),Parameters.ProductNum=s.ProductStock,$(".UnitPrices span").eq(1).html("$"+n.Product.SalePrice),$(".TotlePrices span").eq(1).html("$"+Number(n.Product.SalePrice)*Number($(".CountNums").val()).toFixed(2)))}else $(".Confirm").removeClass("active"),$(".UnitPrices span").eq(1).html("$"+n.Product.SalePrice),$(".TotlePrices span").eq(1).html("$"+Number(n.Product.SalePrice)*Number($(".CountNums").val()).toFixed(2));$("#Product a").each(function(){var r,u,f,n;for(hit=!0,n=0;n<t.length;n++)r=t[n].PropCode,u=$(".spec").find("[propcode='"+r+"']").find("li").hasClass("selected")?$(".spec").find("[propcode='"+r+"']").find("li.selected").attr("id"):undefined,hit&&u&&(hit=this.getAttribute(r)==u);if(this.className=hit?"":"disabled",flag=!1,i){for(f=!0,n=0;n<t.length;n++){var r=t[n].PropCode,e=this.getAttribute(r),o=$(".spec").find("[propcode='"+r+"']").find("li").hasClass("selected")?$(".spec").find("[propcode='"+r+"']").find("li.selected").attr("id"):undefined;if(e!=o){f=!1;break}}if(f)return this.getAttribute("productstock")==0||this.getAttribute("productstock")<Parameters.BuyCount?(Order.Alert("库存不足，所选型号商品剩余"+this.getAttribute("productstock")+"件!"),$this.addClass("disabled"),flag=!1):flag=!0,!1}})}}var e,u,o;if(Parameters.FinalProductId=t.Product.ProductId,Parameters.SkuProduct=t.Product.SkuGroup.SkuProduct,Parameters.LimitBuyCountPerOrder=t.Product.LimitBuyCountPerOrder,Parameters.ProductStock=t.Product.ProductStock,$(".GoodNames").html(t.Product.ProductName),$(".UnitPrices span").eq(1).html("$"+t.Product.SalePrice),$(".Amount span").eq(1).html("1"),$(".TotlePrices span").eq(1).html("$"+Number(t.Product.SalePrice).toFixed(2)),Cookies.set("FinalProductId",Parameters.FinalProductId),$(".specList").html("").show(),t.Product.IsSpu==0)if(this.IsSKU=!1,t.Product.MainProductId==0)$(".specList").hide(),$(".GoPay").addClass("active");else for($(".GoPay").removeClass("active"),e=t.Product.SkuGroup.SellProps,u=0;u<e.length;u++)o='<div class="spec" ><label>'+e[u].PropName+':<\/label><div class="specBox"><span><\/span><ul class="specModels" PropCode="'+e[u].PropCode+'"><\/ul><\/div><\/div>',$(".specList").append(o),$(".spec").eq(u).find(".specModels").append($(e[u].Props).map(function(n,t){return'<li id="'+t.Id+'" >'+t.PName+"<\/li>"}).get().join("")).find("li").click(s);else for(this.IsSKU=!0,$(".specList").show(),e=t.Product.SkuGroup.SellProps,u=0;u<e.length;u++)o='<div class="spec" ><label>'+e[u].PropName+':<\/label><div class="specBox"><span><\/span><ul class="specModels" PropCode="'+e[u].PropCode+'"><\/ul><\/div><\/div>',$(".specList").append(o),$(".spec").eq(u).find(".specModels").append($(e[u].Props).map(function(n,t){return'<li id="'+t.Id+'" >'+t.PName+"<\/li>"}).get().join("")).find("li").click(s);$(".specBox span").each(function(){var n=$(this);n.html(n.siblings("ul").find("li").eq(0).html()).attr("id",n.siblings("ul").find("li").eq(0).attr("id"));n.siblings("ul").find("li").eq(0).trigger("click")});$(".specBox span").on("click",function(){$(this).siblings("ul").toggle().end().toggleClass("active")});$(".specBox").hover(function(){$(this).find("ul").show().end().find("span").addClass("active")},function(){$(this).find("ul").hide().end().find("span").removeClass("active")});Parameters.MaskResult=t},GetVirtualProduct:function(t,i){function u(n){return n instanceof Array||n instanceof Object?!0:!1}function r(n){u(n)?Parameters.virtualObj=n:(n=JSON.parse(n),Parameters.virtualObj=n);$(".UnitPrices span").eq(1).html("$"+n.price);$(".Amount span").eq(1).html("1");$(".TotlePrices span").eq(1).html("$"+Number(n.price).toFixed(2));Cookies.set("FinalProductId",t);Parameters.ProductID=t;Parameters.FinalProductId=t;$(".specList").html("").hide();i&&ConfirmOrder.init()}if(n=null,$(".GoodName").html("MomentCam Caricature (Digital)"),$(".reduce").css({background:"#f5f5f5",cursor:"not-allowed"}),$(".add").css({background:"#fbfbfb",cursor:"not-allowed"}),!$.isEmptyObject(Parameters.virtualObj)){r(Parameters.virtualObj);return}CallAjax(MomentCam.urls.getProductInfo,"id="+t,function(n){r(n)})},GetFinalProductId:function(n){for(var t,f,i,r,e=Parameters.SkuProduct,u=0;u<e.length;u++)for(t=e[u],f=0,i=0;i<n.length;i++)for(r in t.SkuProps)if(t.SkuProps.hasOwnProperty(r)&&t.SkuProps[r].PropCode==n[i].name&&t.SkuProps[r].PropValueId==n[i].id&&(f++,f==n.length))return t}}}(),function(){function i(n){return function(t,i){var r=t[n],u=i[n];return r<u?1:r>u?-1:0}}function t(){var n=(new Date).getTime();return typeof performance!="undefined"&&typeof performance.now=="function"&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(t==="x"?i:i&3|8).toString(16)})}var n={submitObj:{},Common:function(){if($(".Quantity").html(Cookies.get("ProductCount")),Cookies.get("isRenderProduct")=="false"){var t=JSON.parse(Cookies.get("Parameters"));$(".addressBox").hide();$(".PayTitle .Num").html("1");$(".UnitPrice").html("$"+t.price);$(".ItemTotal").html("$"+t.price);$(".Subtotal").html("$"+t.price*1);$(".Discount").html("-$0");$(".Quantity").html("1");$(".ShipingFee").html("$0");$(".Total").html("$"+t.price.toFixed(2));$(".GoodName").html("MomentCam Caricature (Digital)");$(".title,.Money").css("opacity","1");$(".PayBox").removeClass("NoUsed").show();n.submitVirtualProduct()}else $(".addressBox,.PayBox").show(),this.getAllAdress(),this.GetTradeFlow(!1)},PayType:!0,Bind:function(){$(".SaveBtn").off("click").on("click",function(){n.IsInsertFlag?($(".AdressDetail").attr("IsDefault","0"),n.insertAddress()):n.UpdateAddrFlag?n.UpdateAddr():($(".NewOrViewed").remove(),n.GetTradeFlow(!0));n.UpdateAddrFlag=!1});$(".AddressEditBox").off("click").on("click",function(){n.AddrBoxHeight!=0&&($(".addressTitle").addClass("Editing"),$(".oLoading").hide(),$(".PayBox").addClass("NoUsed"),$(".addressBox").animate({height:n.AddrBoxHeight},500,function(){$(".addressBox").css("height","auto")}))});$(".Clicked").off("click").on("click",function(){$(this).hasClass("choosed")||($(this).addClass("choosed").siblings(".Clicked").removeClass("choosed"),$(".oLoading").hide(),$(this).hasClass("CreaditCardBox")?($(".InsertText").show(),n.PayType=!0,$("#PayCard").show(),$("#PayPal").hide(),n.PayCardFlag&&($(this).find(".oLoading").show(),n.InitPayParams(n.submitObj))):(n.PayType=!1,$(".InsertText").hide(),$("#PayCard").hide(),$("#PayPal").show(),n.PayPalFlag&&($(this).find(".oLoading").show(),n.InitPayParams(n.submitObj))))});$(".CreatAdressBtn").off("click").on("click",function(){$(".NewOrViewed").remove();$(".AdressDetail").removeClass("choosed");var t=n.CreatAddreDiv();$(this).hide();$(this).before(t);n.InitMaterial();n.IsInsertFlag=!0;n.UpdateAddrFlag=!1;n.GetAllRegionCode()});$(".CodeSubmit").off("click").on("click",function(){$(".CodeBox input").val().length!=0&&(n.CouponFlag=!0,Cookies.get("isRenderProduct")=="false"?n.checkCoupon():n.GetTradeFlow())});$("#zero").off("click").on("click",function(){if(n.zeroFlag)n.zeroFlag=!1,n.checkCouponFlag?n.submitVirtualProduct():window.location.href="Pages/Success.html?v="+Math.random();else return});$("body").unbind("click").on("click",function(){window.parent.hiding($(this))})},zeroFlag:!0,CouponFlag:!1,SubmitOrder:function(n){n?this.SubmitRealProductOrder():this.submitVirtualProduct()},SubmitRealProductOrder:function(){var t={Token:Cookies.get("TOKEN"),ProductId:Cookies.get("FinalProductId"),ProductCount:parseInt(Cookies.get("ProductCount")),RenderData:'[{CartoonCode:"'+Cookies.get("CartoonCode")+'02", DataUid:"'+Cookies.get("DataUid")+'"}]',ProductIconUrl:Cookies.get("ProductImg"),ProductTrace:"",OrderMsg:""};CallAjax(MomentCam.urls.submitOrderUrl,t,function(t){if(t.StatusCode==0){console.log(t);n.submitObj=t;Cookies.set("result",t);t.PayableAmount==0?($(".ChooseType .Clicked").hide(),$(".Nofee").show(),$(".PayNow").hide(),$("#zero").show()):($(".ChooseType .Clicked").show(),n.PayCardFlag&&n.InitPayParams(n.submitObj));var i={ProductID:Cookies.get("FinalProductId"),OrderNumber:t.OrderIds,ProductName:$(".GoodName").html(),ProductCount:parseInt(Cookies.get("ProductCount")),Price:parseInt($(".UnitPrice").html()),Address:$(".choosed .shipAddress").html(),Customer:$(".choosed .topName").html(),Tel:$(".choosed .SeePhone span").eq(1).html(),Email:$(".choosed").attr("email"),TplCode:50006,BGID:Cookies.get("CartoonCode"),PayAmout:t.PayableAmount};Cookies.set("orderData",i)}else t.StatusCode==111002&&n.Alert(t.Description)})},SubmitVirtualOrder:function(){var i={OrderNumber:n.submitObj.OrderIds,UserID:Cookies.get("UserId"),OrderType:parseInt(Cookies.get("ProductCount")),ProductCount:parseInt(Cookies.get("ProductCount")),ProductID:"444",ResourceNumber:Cookies.get("CartoonCode"),ProductName:"MomentCam Caricature (Digital)",UserImage:Cookies.get("ProductImg").split("?")[0],Thumbnail:Cookies.get("ProductImg").split("?")[0]+"?x-oss-process=image/resize,w_120"},r="language=en&fromtype=h5&appversion=100&extend="+JSON.stringify(i),t;CallAjax(MomentCam.urls.addusercartoonsorder,r,function(n){console.log(n);n.StatusCode=="80000"&&(window.location.href="Success.html")});t={Token:Cookies.get("TOKEN"),Email:$(".choosed").attr("email"),ProductId:Cookies.get("FinalProductId"),ProductCount:parseInt(Cookies.get("ProductCount")),RenderData:'[{CartoonCode:"'+Cookies.get("CartoonCode")+'02", DataUid:"'+Cookies.get("DataUid")+'"}]'};Cookies.set("orderData",t)},submitVirtualProduct:function(){var t={Token:Cookies.get("TOKEN"),Email:"",ProductId:Cookies.get("FinalProductId"),ProductCount:parseInt(Cookies.get("ProductCount")),RenderData:'[{CartoonCode:"'+Cookies.get("CartoonCode")+'02", DataUid:"'+Cookies.get("DataUid")+'"}]'};CallAjax(MomentCam.urls.submitVirtualProduct,t,function(t){if(console.log(t),n.submitObj=t,Cookies.set("result",t),n.checkCouponFlag){n.SaveCouponOne(t.OrderIds);return}t.PayableAmount==0?($(".ChooseType .Clicked").hide(),$(".Nofee").show(),$(".PayNow").hide(),$("#zero").show()):($(".ChooseType .Clicked").show(),n.PayCardFlag&&n.InitPayParams(n.submitObj))})},PayCardFlag:!0,PayPalFlag:!0,InitializationFlag:!0,InitPayParams:function(t){PayOrder.ReturnUrl="Success.html";PayOrder.ShowUrl="../Index.html";PayOrder.Token=Cookies.get("TOKEN");PayOrder.CurrencyUnit=t.CurrencyUnit;PayOrder.OrderInfo=t.OrderInfo;PayOrder.PayType=t.PaymentType;PayOrder.Payable=t.PayableAmount;$(".Clicked").css("cursor","not-allowed");n.PayType?($(".CreaditCardBox").find(".oLoading").show(),PayOrder.PrepareCreditPay("#PayCard",function(){n.PayCardFlag=!1;$(".CreaditCardBox").find(".oLoading").hide();$(".InsertText").show();$("body").Loading("hide");n.InitializationFlag&&(PayOrder.PreparePaypalPay("#PayPal",function(){n.PayPalFlag=!1;$(".PayPal").find(".oLoading").hide();$("body").Loading("hide")},function(t){$(".PayPal").find(".oLoading").hide();$("body").Loading("hide");t.StatusCode==1?(t.Description.indexOf("Some payment input fields are invalid.")>-1&&(t.Description="Your payment information is incorrect. Please check and try again."),n.Alert(t.Description?t.Description:"Oops...Something went wrong.")):t.StatusCode=="-100"?n.Alert("Log in to continue."):n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode)}),n.InitializationFlag=!1)},function(){$(".CreaditCardBox").find(".oLoading").hide();n.InitializationFlag&&(PayOrder.PreparePaypalPay("#PayPal",function(){n.PayPalFlag=!1;$(".PayPal").find(".oLoading").hide();$("body").Loading("hide")},function(){$(".PayPal").find(".oLoading").hide();$("body").Loading("hide")}),n.InitializationFlag=!1)}),$(".Clicked").css("cursor","pointer")):($(".PayPal").find(".oLoading").show(),$(".Clicked").css("cursor","not-allowed"),PayOrder.PreparePaypalPay("#PayPal",function(){n.PayPalFlag=!1;$("#PayCard").hide();$("#PayPal").show();$(".PayPal").find(".oLoading").hide();$("body").Loading("hide")},function(t){$(".PayPal").find(".oLoading").hide();$("body").Loading("hide");t.StatusCode==1?n.Alert(t.Description?t.Description:"Oops...Something went wrong."):t.StatusCode=="-100"?n.Alert("Log in to continue."):n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode)}),$(".Clicked").css("cursor","pointer"))},GetAllRegionCode:function(t){CallAjax(MomentCam.urls.GetAllRegionCode,"Language=en",function(i){var u,f,r;for(console.log(i),n.AllRegionCode=i,u="",f="",r=0;r<n.AllRegionCode.Regions.length;r++)u+="<option class='"+n.AllRegionCode.Regions[r].Id+"'>"+n.AllRegionCode.Regions[r].RegionCode+"<\/option>",f+="<option class='"+n.AllRegionCode.Regions[r].Id+"'>"+n.AllRegionCode.Regions[r].Name+"<\/option>";$(".CountyCode").html(u).val($(".CountyCode option[class=40]").val());$(".CountyList").html(f).val($(".CountyList option[class=40]").val());n.UpdateAddrFlag&&n.getAddr(t);$(".CountyCode").change(function(){var n=$(this).find("option:selected").attr("class");$(".CountyList").val($(".CountyList option[class="+n+"]").val())});$(".CountyList").change(function(){var n=$(this).find("option:selected").attr("class");$(".CountyCode").val($(".CountyCode option[class="+n+"]").val())})})},checkCouponFlag:!1,checkCoupon:function(){CallAjax(MomentCam.urls.checkCoupon,"code="+$(".CodeBox input").val(),function(t){t.StatusCode==80008?(n.code=$(".CodeBox input").val(),$(".CodeBox input").val(""),CallAjax(MomentCam.urls.getProductInfo,"id=444",function(t){console.log(t);n.CouponFlag=!1;n.checkCouponFlag=!0;t.StatusCode==80008&&($(".Discount").html("-$9.99"),$(".Quantity").html("1"),$(".ShipingFee").html("$0"),$(".Total").html("$0"),$(".oLoading").hide(),Cookies.set("FinalProductId","444"),$(".ChooseType .Clicked").hide(),$(".Nofee").show(),$(".PayNow").hide(),$("#zero").show())})):n.Alert("Coupon number not avaliable")})},code:0,SaveCouponOne:function(t){var i={code:n.code,orderid:t,userid:Cookies.get("UserId")};CallAjax(MomentCam.urls.digitalCoupon,i,function(t){console.log(t);t.StatusCode==80008?window.location.href="Success.html":n.zeroFlag=!0})},SaveCoupon:function(){var t={Token:Cookies.get("TOKEN"),ProductId:Cookies.get("FinalProductId"),ProductCount:Cookies.get("ProductCount"),CouponCode:$(".CodeBox input").val(),DeviceId:1};CallAjax(MomentCam.urls.saveCoupon,t,function(t){console.log(t);n.CouponFlag=!1;t.StatusCode==0?($(".CodeBox input").val(""),$(".Discount").html("-$"+t.CouponAmount),$(".Total").html("$"+t.PayableAmount.toFixed(2)),t.PayableAmount==0?($(".ChooseType .Clicked").hide(),$(".Nofee").show(),$(".PayNow").hide(),$("#zero").show()):($(".ChooseType .Clicked").show(),$(".Nofee").hide()),$(".addressTitle").hasClass("Editing")||n.SubmitOrder(Cookies.get("isRenderProduct"))):t.StatusCode=="111012"?n.Alert("Invalid promo code"):t.StatusCode=="111013"?n.Alert("This promo code has been used already"):t.StatusCode=="111014"?n.Alert("This promo code cannot be used for this order"):t.StatusCode=="111016"?n.Alert("This promo code has expired or is not currently valid"):t.StatusCode=="111017"?n.Alert("This promo code cannot be used anymore"):n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode)})},CreatAddreDiv:function(){return'<div class="NewOrViewed"><h3 style="line-height:20px;">New address<\/h3><div id="tf-box-example" style="margin-right:10px;" class="mdc-textfield mdc-textfield--box mdc-textfield--upgraded mdc-ripple-upgraded mdc-textfield--invalid"><input type="text" id="tf-box" class="Email mdc-textfield__input" required="" aria-controls="name-validation-message"><label for="tf-box" class="mdc-textfield__label">Email<\/label><div class="mdc-textfield__bottom-line"><\/div><\/div><div id="tf-box-example" class="mdc-textfield mdc-textfield--box mdc-textfield--upgraded mdc-ripple-upgraded mdc-textfield--invalid"><input type="text" id="tf-box" class="Name mdc-textfield__input" required="" aria-controls="name-validation-message"><label for="tf-box" class="mdc-textfield__label">Recipient<\/label><div class="mdc-textfield__bottom-line"><\/div><\/div><div id="tf-box-example" style="margin-right:10px;" class="mdc-textfield mdc-textfield--box mdc-textfield--upgraded mdc-ripple-upgraded mdc-textfield--invalid"><input type="text" id="tf-box" class="Address mdc-textfield__input" required="" aria-controls="name-validation-message"><label for="tf-box" class="mdc-textfield__label">Address<\/label><div class="mdc-textfield__bottom-line"><\/div><\/div><div id="tf-box-example" class="mdc-textfield mdc-textfield--box mdc-textfield--upgraded mdc-ripple-upgraded mdc-textfield--invalid"><input type="text" id="tf-box" class="Apt mdc-textfield__input" required="" aria-controls="name-validation-message"><label for="tf-box" class="mdc-textfield__label">Apt/Suite<\/label><div class="mdc-textfield__bottom-line"><\/div><\/div><div id="tf-box-example" class="mdc-textfield mdc-textfield--box mdc-textfield--upgraded mdc-ripple-upgraded mdc-textfield--invalid"><input type="text" id="tf-box" class="City mdc-textfield__input" required="" aria-controls="name-validation-message"><label for="tf-box" class="mdc-textfield__label">City<\/label><div class="mdc-textfield__bottom-line"><\/div><\/div><div id="tf-box-example" style="margin:10px 10px 0;" class="mdc-textfield mdc-textfield--box mdc-textfield--upgraded mdc-ripple-upgraded mdc-textfield--invalid"><input type="text" id="tf-box" class="State mdc-textfield__input" required="" aria-controls="name-validation-message"><label for="tf-box" class="mdc-textfield__label">State/Province<\/label><div class="mdc-textfield__bottom-line"><\/div><\/div><div id="tf-box-example" class="mdc-textfield mdc-textfield--box mdc-textfield--upgraded mdc-ripple-upgraded mdc-textfield--invalid"><input type="text" id="tf-box" class="ZipCode mdc-textfield__input" required="" aria-controls="name-validation-message"><label for="tf-box" class="mdc-textfield__label">Zip code<\/label><div class="mdc-textfield__bottom-line"><\/div><\/div><div class="CountyCodeBox"><select class="CountyCode"><\/select><\/div><div id="tf-box-example" style="margin:10px 10px 0;" class="mdc-textfield mdc-textfield--box mdc-textfield--upgraded mdc-ripple-upgraded mdc-textfield--invalid"><input type="text" id="tf-box" class="PhoneNum mdc-textfield__input" required="" aria-controls="name-validation-message"><label for="tf-box" class="mdc-textfield__label">Phone number<\/label><div class="mdc-textfield__bottom-line"><\/div><\/div><div class="CountyListBox"><select class="CountyList"><\/select><\/div><\/div>'},InitMaterial:function(){(function(){for(var i=document.querySelectorAll(".mdc-textfield:not([data-demo-no-auto-js])"),n=0,t;t=i[n];n++)mdc.textfield.MDCTextfield.attachTo(t)})()},getAddr:function(t){var i={token:Cookies.get("TOKEN"),Id:t,Language:"en"};CallAjax(MomentCam.urls.getAddrUrl,i,function(t){console.log(t);t.StatusCode==0?($(".PhoneNum").val(t.Addr.Mobile),$(".Email").val(t.Addr.Email),$(".Name").val(t.Addr.ShipName),$(".Address").val(t.Addr.AddrDetail),$(".Apt").val(t.Addr.AddrDetail1),$(".State").val(t.Addr.StateName),$(".City").val(t.Addr.IntlCityName),$(".CountyCode").val(t.Addr.RegionCode),$(".ZipCode").val(t.Addr.PostCode),$(".CountyList").val(t.Addr.CountryName),$(".edit.active").removeClass("active")):t.StatusCode=="-100"?n.Alert("Log in to continue."):n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode)})},SaveAddrId:0,AllAdress:[],getAllAdress:function(){var t={token:Cookies.get("TOKEN"),Language:"en"};CallAjax(MomentCam.urls.getAllAdressUrl,t,function(t){var u,f,r;if(console.log(t),t.StatusCode==0)if(n.AllAdress=t.AddrList,t.AddrList.sort(i("IsDefault")),t.AddrList.length==0)$(".CreatAdressBtn").trigger("click");else{for(u="",f=t.AddrList.length>1?"2":t.AddrList.length,r=0;r<f;r++)u+='<div class="AdressDetail" email="'+t.AddrList[r].Email+'" AddrId = "'+t.AddrList[r].AddrId+'" IsDefault = "'+t.AddrList[r].IsDefault+'"><div class="top"><span class="topName">'+t.AddrList[r].ShipName+'<\/span><span class="Delete">Delete<\/span><span class="edit">Edit<\/span><\/div><p class="SeePhone"><span>'+t.AddrList[r].RegionCode+"<\/span> <span>"+t.AddrList[r].Mobile+'<\/span><\/p><p class="shipAddress">'+t.AddrList[r].AddrDetail1+", "+t.AddrList[r].AddrDetail+", "+t.AddrList[r].IntlCityName+", "+t.AddrList[r].StateName+".<\/p><\/div>";$(".DetailList").prepend(u);$(".AdressDetail").eq(0).addClass("choosed");n.SaveAddrId=$(".AdressDetail").eq(0).attr("AddrId");$(".CreatAdressBtn").show();$(".AdressDetail").off("click").on("click",function(){$(this).hasClass("choosed")||($(this).addClass("choosed").siblings(".AdressDetail").removeClass("choosed"),$(".NewOrViewed").remove(),n.SaveAddrId=$(this).attr("AddrId"),n.UpdateAddrFlag=!1,n.IsInsertFlag=!1,$(".CreatAdressBtn").show())});$(".edit").off("click").on("click",function(){if(!$(this).hasClass("active")){$(".edit").removeClass("active");$(this).addClass("active");n.IsDefault=$(this).parent().parent().attr("IsDefault");n.IsInsertFlag=!1;n.UpdateAddrFlag=!0;$(this).parent().parent().addClass("choosed").siblings(".AdressDetail").removeClass("choosed");$(".NewOrViewed").remove();var t=n.CreatAddreDiv();return $(this).parent().parent().after(t),$(".NewOrViewed").find(".mdc-textfield__label").addClass("mdc-textfield__label--float-above"),n.InitMaterial(),n.UpdateAddrId=$(this).parent().parent().attr("AddrId"),n.SaveAddrId=n.UpdateAddrId,n.GetAllRegionCode(n.UpdateAddrId),!1}});$(".Delete").off("click").on("click",function(){var t=$(this).parent().parent().attr("AddrId");return n.deleteAddress(t),!1})}else t.StatusCode=="-100"?n.Alert("Log in to continue."):n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode)})},IsInsertFlag:!1,insertAddress:function(){var t={token:Cookies.get("TOKEN"),CountryId:$(".CountyList option:selected").attr("class"),Mobile:$(".PhoneNum").val(),Email:$(".Email").val(),ShipName:$(".Name").val(),AddrDetail:$(".Address").val(),AddrDetail1:$(".Apt").val(),StateName:$(".State").val(),CityName:$(".City").val(),IsDefault:1,AddrType:"2",RegionCode:$(".CountyCode").val(),PostCode:$(".ZipCode").val(),countryName:$(".CountyList").val()};CallAjax(MomentCam.urls.insertAddressUrl,t,function(t){if(console.log(t),t.StatusCode==0){n.IsInsertFlag=!1;var i='<div class="AdressDetail choosed" AddrId = "'+t.AddrId+'" IsDefault = "1"><div class="top"><span class="topName">'+$(".Name").val()+'<\/span><span class="Delete">Delete<\/span><span class="edit">Edit<\/span><\/div><p class="SeePhone"><span>'+$(".CountyCode").val()+"<\/span> <span>"+$(".PhoneNum").val()+'<\/span><\/p><p class="shipAddress">'+$(".Apt").val()+", "+$(".Address").val()+", "+$(".City").val()+", "+$(".State").val()+".<\/p><\/div>";$(".AdressDetail").removeClass("choosed");$(".DetailList").prepend(i);$(".NewOrViewed").remove();$(".CreatAdressBtn").show();n.SaveAddrId=t.AddrId;n.saveConsignee();$(".AdressDetail").off("click").on("click",function(){$(this).hasClass("choosed")||($(".edit").removeClass("active"),$(this).addClass("choosed").siblings(".AdressDetail").removeClass("choosed"),$(".NewOrViewed").remove(),n.SaveAddrId=$(this).attr("AddrId"),n.UpdateAddrFlag=!1,n.IsInsertFlag=!1,$(".CreatAdressBtn").show())});$(".edit").off("click").on("click",function(){if(!$(this).hasClass("active")){$(".edit").removeClass("active");$(this).addClass("active");n.IsInsertFlag=!1;n.UpdateAddrFlag=!0;n.IsDefault=$(this).parent().parent().attr("IsDefault");$(this).parent().parent().addClass("choosed").siblings(".AdressDetail").removeClass("choosed");$(".NewOrViewed").remove();var t=n.CreatAddreDiv();return $(this).parent().parent().after(t),$(".NewOrViewed").find(".mdc-textfield__label").addClass("mdc-textfield__label--float-above"),n.InitMaterial(),n.GetAllRegionCode(),n.UpdateAddrId=$(this).parent().parent().attr("AddrId"),n.SaveAddrId=n.UpdateAddrId,setTimeout(function(){n.getAddr(n.UpdateAddrId)},500),!1}});$(".Delete").off("click").on("click",function(){var t=$(this).parent().parent().attr("AddrId");return n.deleteAddress(t),!1})}else t.StatusCode=="-100"?n.Alert("Log in to continue."):t.StatusCode=="113001"?n.Alert("Maximum number of addresses reached. Please delete some to add new addresses"):t.StatusCode=="113005"?n.Alert("Please enter a valid phone number"):t.StatusCode=="113007"?n.Alert("Please enter a valid recipient (special characters not accepted)"):t.StatusCode=="113008"?n.Alert("Please enter a valid delivery address (special characters not accepted)"):n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode)})},IsDefault:0,UpdateAddrId:0,UpdateAddrFlag:!1,UpdateAddr:function(){var t={token:Cookies.get("TOKEN"),Id:n.UpdateAddrId,CountryId:$(".CountyList option:selected").attr("class"),Mobile:$(".PhoneNum").val(),Email:$(".Email").val(),ShipName:$(".Name").val(),AddrDetail:$(".Address").val(),AddrDetail1:$(".Apt").val(),StateName:$(".State").val(),CityName:$(".City").val(),IsDefault:n.IsDefault,AddrType:"2",RegionCode:$(".CountyCode").val(),PostCode:$(".ZipCode").val(),countryName:$(".CountyList").val()};CallAjax(MomentCam.urls.updateAddressUrl,t,function(t){if(console.log(t),t.StatusCode==0){var r=n.UpdateAddrId,i=$(".AdressDetail[AddrId='"+r+"']");i.find(".topName").html($(".Name").val());i.find(".SeePhone span").eq(0).html($(".CountyCode").val());i.find(".SeePhone span").eq(1).html($(".PhoneNum").val());i.find(".shipAddress").html($(".Apt").val()+", "+$(".Address").val()+", "+$(".City").val()+", "+$(".State").val()+".");i.find(".NewOrViewed").remove();n.UpdateAddrFlag=!1;n.saveConsignee()}else t.StatusCode=="-100"?n.Alert("Log in to continue."):t.StatusCode=="113005"?n.Alert("Please enter a valid phone number"):t.StatusCode=="113007"?n.Alert("Please enter a valid recipient (special characters not accepted)"):t.StatusCode=="113008"?n.Alert("Please enter a valid delivery address (special characters not accepted)"):n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode)})},saveConsignee:function(){var i={Token:Cookies.get("TOKEN"),ProductId:Cookies.get("FinalProductId"),ProductCount:parseInt(Cookies.get("ProductCount")),AddrId:n.SaveAddrId,DeviceId:t()};CallAjax(MomentCam.urls.saveConsignee,i,function(t){console.log(t);t.StatusCode==0?($(".Discount").html("-$"+t.CouponAmount),$(".ShipingFee").html("$"+t.Orders[0].ShippingFee),$(".Total").html("$"+t.PayableAmount.toFixed(2)),n.AddrBoxToggle(),t.PayableAmount.toFixed(2)==0?($(".ChooseType .Clicked").hide(),$(".Nofee").show(),$(".PayNow").hide(),$("#zero").show()):($(".ChooseType .Clicked").show(),$(".Nofee").hide()),n.SubmitOrder(Cookies.get("isRenderProduct"))):t.StatusCode=="-100"?n.Alert("Log in to continue."):t.StatusCode=="111011"?n.Alert("No delivery possible to this address"):n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode)})},deleteAddress:function(t){var i={token:Cookies.get("TOKEN"),Id:t};CallAjax(MomentCam.urls.deleteAddressUrl,i,function(i){console.log(i);i.StatusCode==0?($(".AdressDetail[AddrId$="+t+"]").remove(),$(".AdressDetail").length==0&&$(".CreatAdressBtn").trigger("click")):i.StatusCode=="-100"?n.Alert("Log in to continue."):n.Alert("Oops...Something went wrong. Error code:"+i.StatusCode)})},GetTradeFlow:function(i){var r={Token:Cookies.get("TOKEN"),ProductId:Cookies.get("FinalProductId"),ProductCount:parseInt(Cookies.get("ProductCount")),FromType:MomentCam.config.platform,DeviceId:t(),Language:"en"};CallAjax(MomentCam.urls.getTradeFlow,r,function(t){console.log(t);t.StatusCode==0?($(".UnitPrice").html("$"+t.Orders[0].Products[0].SalePrice),$(".ItemTotal").html("$"+t.Orders[0].Products[0].SalePrice),$(".Subtotal").html("$"+t.Orders[0].SalePriceTotal),$(".Discount").html("-$"+t.CouponAmount),$(".Quantity").html(Cookies.get("ProductCount")),$(".ShipingFee").html("$"+t.Orders[0].ShippingFee),$(".Total").html("$"+t.PayableAmount.toFixed(2)),$(".GoodName").html(t.Orders[0].Products[0].ProductName),n.CouponFlag&&n.SaveCoupon(),i&&n.saveConsignee()):t.StatusCode==111e3?n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode):t.StatusCode==-100?n.Alert("Log in to continue"):t.StatusCode==111001?n.Alert("Oops...Something went wrong. Error code:"+t.StatusCode):t.StatusCode==111007?n.Alert("This product does not exist or is not available anymore"):t.StatusCode==111008?n.Alert("This product is out of stock at the moment"):t.StatusCode==111009?n.Alert("This product is sold out"):t.StatusCode==111010?n.Alert("Maximum purchase amount exceeded"):n.Alert("Network unaliable, please try again")})},AddrBoxHeight:0,AddrBoxToggle:function(){n.AddrBoxHeight=$(".addressBox").height();$(".addressBox").animate({height:"32px"},500,function(){$(".addressTitle").removeClass("Editing");$(".PayBox").removeClass("NoUsed")})},Alert:function(n){$("#mdc-dialog-default").find("#mdc-dialog-default-description").html(n);$("#default-dialog-activation").trigger("click")},init:function(){this.Common();this.Bind()}};window.Order=n}();var POP=function(){return{isInit:!1,setinterval:0,loadingText:["Use a clear picture from a front angle","MomentCam has over 350 million users worldwide","MomentCam was the recipient of the Facebook FbStart App of the Year 2015","Avatar being created"],ShowLoading:function(){var n=0,t=this;$("body").Loading(t.loadingText[0]);this.setinterval=setInterval(function(){n==3&&(n=0);n++;$("body").Loading(t.loadingText[n])},1500)},CloseLoading:function(){$("body").Loading("hide");$(".loading").hide();clearTimeout(this.setinterval)},Alert:function(n){$("#mdc-dialog-default").css("opacity","1").find("#mdc-dialog-default-description").html(n);$("#default-dialog-activation").trigger("click")},displayControl:function(n,t){$("#part"+n).css("display","block").siblings().hide();n==1&&($(".BeautyLeft").css("display","block"),$(".ProductLeft").css("display","none"),$(".buttonGroup .a").show(),$(".buttonGroup .b").hide(),$(".resetGroup .a").hide());n==2&&($(".BeautyLeft").css("display","none"),$(".ProductLeft").css("display","block"),$(".buttonGroup .b").show(),$(".buttonGroup .a").hide(),$(".resetGroup .a").show(),ProductThumb.init(t),Theme.init(t))},ShowLogin:function(n){return window.parent.showing(n),n},StartLoading:function(){$(".loading").css("display")=="none"&&($(".loading").fadeIn(),$("[name='renderResult']").attr("src",""))},CheckLogin:function(){var n=$.Deferred();return setTimeout(function(){var t=Cookies.get("user"),i;t?(t=JSON.parse(t),i=t.Token,CallAjax(MomentCam.urls.checkUser,"TOKEN="+i,function(t){t.StatusCode==0?n.resolve():n.reject()})):n.reject()},200),n.promise()}}}(),noFavorite=!1,ProductThumb=function(){function n(n){t(n);i()}function t(n){if(!n){$(".productContainer .swiper-slide").eq(0).addClass("active");ProductHandler.GetVirtualProduct(MomentCam.urls.VirtualID);$(".productContainer .swiper-slide").unbind("click").on("click",function(){if(Parameters.clickCheck&&!$(this).hasClass("active")){$(this).index()==0?$(".add").css("cursor","not-allowed").unbind("click"):$(".add").css("cursor","pointer").bind("click");$(".CountNum").html("1");$(this).addClass("active").siblings().removeClass("active");var n=$(this).find("img").attr("data-id");n?(Parameters.clickCheck=!1,Parameters.isRenderProduct=!0,ProductHandler.GetProduct(n)):(Parameters.FinalProductId=424,Parameters.isRenderProduct=!1,comicButtonEvent())}})}}function i(){if(Parameters.RandomThemesID.length==0)CallAjax(MomentCam.urls.getallthemeUrl,"language=zh&fromtype=android&appversion=1.0&coreid=5&parid=0&dataversion=1",function(n){n=n.RootListJson.filter(function(n){return n.Name=="大分类"});n=n[0].StemsListJson;for(var t in n)n.hasOwnProperty(t)&&Parameters.RandomThemesID.push(n[t].tid)})}return{init:n}}(),Theme=function(){function u(){f();i(238)}function f(){$(".themeNav li").on("click",function(n){var t,u;if(n.stopPropagation(),!$(this).hasClass("active")){t=$(this).index();t!=0?$(this).addClass("active").siblings().removeClass("active").removeClass("themeActive"):($(this).addClass("themeActive"),$(".themeNav li").removeClass("active"));$("#autocomplete").val("");switch(t){case 0:{if(!Parameters.clickCheck)return;Parameters.clickCheck=!1;u=Parameters.RandomThemesID[f(0,Parameters.RandomThemesID.length)];function f(n,t){return Math.floor(Math.random()*(t-n+1)+n)}i(u);$(this).siblings().removeClass("active");$(".themeNav .mdc-tab-bar__indicator").hide();break}case 1:$(".themeNav .mdc-tab-bar__indicator").show();i(238);break;case 2:if($(".themeNav .mdc-tab-bar__indicator").show(),noFavorite){$(".themeThumbWrapper").hide();$("#noFavoriteTip").show();return}$.when(POP.CheckLogin()).done(function(){r()}).fail(function(){POP.ShowLogin(function(){r()})})}}})}function r(){var i="800",r;n[i]||(n[i]={});n[i][Parameters.Gender]==null?(r="token="+Cookies.get("TOKEN")+"&themeid=1",CallAjax(MomentCam.urls.GetFavoriteUrl,r,function(n){var r,u,i,f;if(n.StatusCode=="18008")if(n.Items.length>0){for(r={},r.ResourceLst=[],u=n.Items,i=0;i<u.length;i++)f={},f.ICOPath="Images/MomentCamColorV3/background/"+u[i].ResNumber+"03",f.Name=u[i].ResNumber,r.ResourceLst.push(f);t(r,"800")}else noFavorite=!0,$(".themeThumbWrapper").hide(),$("#noFavoriteTip").show()})):(t(n[i][Parameters.Gender]),$("body").Loading("hide"))}function i(i){var u,r;$("#noFavoriteTip").hide();$(".themeThumbWrapper").show();n[i]||(n[i]={});u=this;n[i][Parameters.Gender]==null?(r={},r.localtime="",r.test="",r.language="zh",r.fromtype="android",r.appversion="3.9",r.themeid=i,r.coreid=5,CallAjax(MomentCam.urls.getresourceUrl,"language=zh&fromtype=android&appversion=80&extend="+JSON.stringify(r),function(n){t(n,i)})):(t(n[i][Parameters.Gender]),$("body").Loading("hide"))}function t(t,i,r){var b,l,a,h,u,s,y,p,w;Parameters.BGID="";b="";Parameters.swiperObj.bg&&(Parameters.swiperObj.bg.setWrapperTranslate(0),Parameters.swiperObj.bg.destroy());var o=[],c=[],h="",e=$("#themeContainer");for(e.find(".swiper-wrapper").html(""),l=MomentCam.config.isSupportWebp?"?x-oss-process=image/format,webp/quality,q_80":"",a=[],u=0;u<t.ResourceLst.length;u++){var v=t.ResourceLst[u].Name.substr(3,1),f=t.ResourceLst[u].ICOPath,k=f.lastIndexOf("/");f=f.substring(k+1);f=f.substring(0,f.length-2);!r||f.startWith("004")||f.startWith("006")?(Parameters.BGID||f.startWith("004")||f.startWith("006")||Parameters.Gender!=v||(Parameters.BGID=t.ResourceLst[u].Name),f.startWith("004")||f.startWith("006")||Parameters.Gender!=v||(c.push(t.ResourceLst[u].Name),imgPath=Parameters.config.ImagePrefix+t.ResourceLst[u].ICOPath+l,o.push(imgPath))):(a.push(t.ResourceLst[u].Name),Parameters.BGID=a[0],c.push(t.ResourceLst[u].Name),imgPath=Parameters.config.ImagePrefix+t.ResourceLst[u].ICOPath+l,o.push(imgPath))}for(h="",u=0;u<o.length;u++)h+='<div class="iconWrapper"><img src="'+o[u]+'" id="'+c[u]+'"/><\/div>';o==0&&(h="<p style='width:100%;position:absolute;left:0;top:45%;text-align:center;font-size:14px;color:#999;'>Can't find the keyword, You may like these<\/p>");e.find(".swiper-wrapper").append('<div class="swiper-slide" style="position:relative;">'+h+"<\/div>");s="";y="";$.each(e.find(".iconWrapper"),function(n,t){s+=" "+checkInView($(t),!1,e);y+=" "+checkInView($(t),!0,e)});p=s.substr(0,4);w=s.substr(s.length-4);changeBtn(p,w,e);$("#themeContainer .swiper-container-assets").scroll(function(){var n="",r="",t,i;$.each(e.find(".iconWrapper"),function(t,i){n+=" "+checkInView($(i),!1,e);r+=" "+checkInView($(i),!0,e)});t=n.substr(0,4);i=n.substr(n.length-4);changeBtn(t,i,e)});$("#themeContainer .iconWrapper").eq(0).find("img").eq(0).addClass("active");n[i]||(n[i]={});n[i][Parameters.Gender]=t;POP.StartLoading();$("#themeContainer img").unbind("click").bind("click",comicButtonEvent);Parameters.isRenderProduct?CarouseFigureMask(Parameters.MaskResult):GoRender(Parameters.BGID,function(){Parameters.clickCheck=!0})}var n={},e={getSearch:function(n,i,r){console.log(n);t(n,i,r)}};return{search:e,init:u}}();ProductHandler={GetProduct:function(n){if($(".add").css({background:"#fbfbfb",cursor:"pointer"}),Parameters.ProductSaver[n]){Parameters.clickCheck=!0;this.DealProduct(Parameters.ProductSaver[n]);return}var i=this,t={};t.Id=n;t.Language="zh";t.fromtype="pc";t.AppVersion="3.9";jQuery.ajax({type:"post",async:!0,dataType:"json",url:MomentCam.urls.getProductUrl,timeout:25e3,contentType:"application/json; charset=utf-8",cache:!1,data:JSON.stringify(t),success:function(t){Parameters.ProductSaver[n]=t;ProductObj=t;i.DealProduct(t)}})},DealProduct:function(n){function u(){var s,i,n,r,f,e,t,u;if(!$(this).hasClass("disabled")){for($(this).toggleClass("selected").siblings().removeClass("selected"),s=$(this).closest(".specModels").attr("propcode"),i=[],$(".specModels").each(function(){var n=$(this).find(".selected");n.length>0&&i.push({PropCode:$(this).attr("propcode"),PropValueId:n.attr("id")})}),$(".spec").each(function(){var t=$(this).find(".specModels"),n=t.attr("propcode");s!=n&&t.find("a").each(function(){var u,r,t;if($(this).removeClass("disabled"),u=$(this).attr("id"),!$(this).hasClass("selected")){for(r=[],t=0;t<i.length;t++)i[t].PropCode!=n&&r.push(i[t]);r.push({PropCode:n,PropValueId:u});getSkuProductBySelectedProps(r).length==0&&$(this).removeClass("selected").addClass("disabled")}})}),n=Parameters.SkuProduct[0].SkuProps,isSelectAll=!0,t=0;t<n.length;t++)if(r=n[t].PropCode,f=$(".spec").find("[propcode='"+r+"']").find("a").hasClass("selected")?$(".spec").find("[propcode='"+r+"']").find("a.selected").attr("id"):undefined,!f){isSelectAll=!1;break}if(isSelectAll){for(e=[],t=0;t<n.length;t++){var r=n[t].PropCode,f=$(".spec").find("[propcode='"+r+"']").find("a").hasClass("selected")?$(".spec").find("[propcode='"+r+"']").find("a.selected").attr("id"):undefined,o={};o.name=n[t].PropCode;o.id=f;f&&e.push(o)}$(".Confirm").addClass("active");u=ProductHandler.GetFinalProductId(e);u!=null&&u.ProductStock>0&&(Parameters.FinalProductId=u.ProductId,Cookies.set("FinalProductId",Parameters.FinalProductId),Parameters.ProductNum=u.ProductStock,$(".UnitPrice span").eq(1).html("$"+ProductObj.Product.SalePrice),$(".TotlePrice span").eq(1).html("$"+Number(ProductObj.Product.SalePrice)*Number($(".CountNum").html()).toFixed(2)))}else $(".Confirm").removeClass("active"),$(".UnitPrice span").eq(1).html("$"+ProductObj.Product.SalePrice),$(".TotlePrice span").eq(1).html("$"+Number(ProductObj.Product.SalePrice)*Number($(".CountNum").html()).toFixed(2));$("#Product a").each(function(){var i,r,u,t;for(hit=!0,t=0;t<n.length;t++)i=n[t].PropCode,r=$(".spec").find("[propcode='"+i+"']").find("a").hasClass("selected")?$(".spec").find("[propcode='"+i+"']").find("a.selected").attr("id"):undefined,hit&&r&&(hit=this.getAttribute(i)==r);if(this.className=hit?"":"disabled",flag=!1,isSelectAll){for(u=!0,t=0;t<n.length;t++){var i=n[t].PropCode,f=this.getAttribute(i),e=$(".spec").find("[propcode='"+i+"']").find("a").hasClass("selected")?$(".spec").find("[propcode='"+i+"']").find("a.selected").attr("id"):undefined;if(f!=e){u=!1;break}}if(u)return this.getAttribute("productstock")==0||this.getAttribute("productstock")<Parameters.BuyCount?($.dialog.tips("库存不足，所选型号商品剩余"+this.getAttribute("productstock")+"件!"),$this.addClass("disabled"),flag=!1):flag=!0,!1}})}}var i,t,r;try{Parameters.FinalProductId=n.Product.ProductId}catch(f){Parameters.clickCheck=!0}if(Parameters.SkuProduct=n.Product.SkuGroup.SkuProduct,Parameters.LimitBuyCountPerOrder=n.Product.LimitBuyCountPerOrder,Parameters.ProductStock=n.Product.ProductStock,$(".UnitPrice span").eq(1).html("$"+n.Product.SalePrice),$(".rightPart span").eq(0).html("$"+n.Product.SalePrice),$(".CountNum").html("1"),$(".TotlePrice span").eq(1).html("$"+Number(n.Product.SalePrice).toFixed(2)),$(".Buy span").eq(0).html("$"+n.Product.SalePrice).show(),Cookies.set("FinalProductId",Parameters.FinalProductId),$(".specList").html("").show(),n.Product.IsSpu==0)if(this.IsSKU=!1,n.Product.MainProductId==0)$(".specList").hide(),$(".Confirm").addClass("active");else for($(".Confirm").removeClass("active"),i=n.Product.SkuGroup.SellProps,t=0;t<i.length;t++)r='<div class="spec" ><h3>'+i[t].PropName+'<\/h3><div class="specModels" PropCode="'+i[t].PropCode+'"><\/div><\/div>',$(".specList").append(r),$(".spec").eq(t).find(".specModels").append($(i[t].Props).map(function(n,t){return'<a id="'+t.Id+'" href="javascript:void(0);" >'+t.PName+"<\/a>"}).get().join("")).find("a").click(u);else for(this.IsSKU=!0,$(".specList").show(),i=n.Product.SkuGroup.SellProps,t=0;t<i.length;t++)r='<div class="spec" ><h3>'+i[t].PropName+'<\/h3><div class="specModels" PropCode="'+i[t].PropCode+'"><\/div><\/div>',$(".specList").append(r),$(".spec").eq(t).find(".specModels").append($(i[t].Props).map(function(n,t){return'<a id="'+t.Id+'" href="javascript:void(0);" >'+t.PName+"<\/a>"}).get().join("")).find("a").click(u);Parameters.MaskResult=n;Parameters.isRenderProduct&&CarouseFigureMask(n)},GetVirtualProduct:function(n,t){function r(n){return n instanceof Array||n instanceof Object?!0:!1}function i(i){r(i)?Parameters.virtualObj=i:(i=JSON.parse(i),Parameters.virtualObj=i);$(".UnitPrice span").eq(1).html("$"+i.price);$(".CountNum").html("1");$(".TotlePrice span").eq(1).html("$"+Number(i.price).toFixed(2));i.price!=0&&$(".Buy span").eq(0).html("$"+i.price).show();Cookies.set("FinalProductId",n);Parameters.ProductID=n;Parameters.FinalProductId=n;$(".specList").html("").hide();t&&ConfirmOrder.init()}if(ProductObj=null,$(".GoodName").html("MomentCam Caricature (Digital)"),$(".reduce").css({background:"#f5f5f5",cursor:"not-allowed"}),$(".add").css({background:"#fbfbfb",cursor:"not-allowed"}),!$.isEmptyObject(Parameters.virtualObj)){i(Parameters.virtualObj);return}CallAjax(MomentCam.urls.getProductInfo,"id="+n,function(n){i(n)})},GetFinalProductId:function(n){for(var t,f,i,r,e=Parameters.SkuProduct,u=0;u<e.length;u++)for(t=e[u],f=0,i=0;i<n.length;i++)for(r in t.SkuProps)if(t.SkuProps.hasOwnProperty(r)&&t.SkuProps[r].PropCode==n[i].name&&t.SkuProps[r].PropValueId==n[i].id&&(f++,f==n.length))return t}};var ConfirmFlag=!1,isSelectAll=!1,BindEvent={init:function(){$(".swiper-button-next").on("click",function(){$($(this).parent().find(".swiper-wrapper")).animate({scrollLeft:"+=650"},500,function(){})});$(".swiper-button-prev").on("click",function(){$($(this).parent().find(".swiper-wrapper")).animate({scrollLeft:"-=650"},500,function(){})});$(".resetGroup .a").on("click",function(){window.location.href="beauty.html?v="+Math.random()});$(".resetGroup .b").on("click",function(){window.location.href="upload.html?v="+Math.random()});$(".Buy").on("click",this.BuyClick);$(".order_Main,.chooseSpec").on("click",function(){return!1});$(".chooseSpecCover").not(".addAddress").on("click",function(){ConfirmFlag?Confirm("malesss"):($(".chooseSpecCover").fadeOut(),$(".chooseSpec").animate({right:"-552px"},300),$(".order_Main").animate({right:"-1034px"},300))});$(".UseCodeBtn").on("click",function(){Confirm("u")});$(".Confirm").on("click",function(){$(".Code input").val("");$(".productName span").eq(1).html("");Parameters.isRenderProduct?($(".EmailBox").hide(),$(".EmailBox input").val(""),$(".addressesBox").show()):($(".EmailBox").show(),$(".EmailBox input").val(""),$(".addressesBox").hide());Cookies.set("isRenderProduct",Parameters.isRenderProduct);Cookies.set("Parameters",Parameters.virtualObj);isSelectAll?(Cookies.set("ProductCount",$(".CountNum").html()),Cookies.set("ProductImg",$("[name='renderResult']").attr("src")),window.location.href="order.html?v="+Math.random()):$(".specList").css("display")=="none"?(Cookies.set("ProductCount",$(".CountNum").html()),Cookies.set("ProductImg",$("[name='renderResult']").attr("src")),window.location.href="order.html?v="+Math.random()):POP.Alert("Please select model!")});$(".submitButton").on("click",function(){Parameters.clickCheck&&ConfirmOrder.SubmitOrder(Parameters.isRenderProduct)});$(".reduce").on("click",function(){var n,t;Number($(".CountNum").html())!=1&&(Parameters.BuyCount=Number($(".CountNum").html()),n=1,Parameters.ProductStock==0&&(n=0),Parameters.BuyCount<=n?Parameters.BuyCount=n:Parameters.BuyCount--,Parameters.BuyCount>1?$(".reduce").css({background:"#f5f5f5",cursor:"pointer"}):$(".reduce").css({background:"#fbfbfb",cursor:"not-allowed"}),$(".CountNum").html(Parameters.BuyCount),t=0,t=ProductObj?ProductObj.Product.SalePrice:9.99,$(".TotlePrice span").eq(1).html("$"+(Number(t)*Number($(".CountNum").html())).toFixed(2)))});$(".add").on("click",function(){var n,t,i;Parameters.BuyCount=Number($(".CountNum").html());n=0;t="";ProductObj?Parameters.ProductStock>Parameters.LimitBuyCountPerOrder?(n=Parameters.LimitBuyCountPerOrder,t="每件商品限购"+n+"件"):(n=Parameters.ProductStock,t="资源紧张，库存不足！"):($(".add").css({background:"#fbfbfb",cursor:"not-allowed"}),n=1);Parameters.BuyCount>=n?Parameters.BuyCount=n:Parameters.BuyCount++;Parameters.BuyCount>1&&ProductObj?($(".reduce").css({background:"#f5f5f5",cursor:"pointer"}),$(".add").css({background:"#fbfbfb",cursor:"pointer"})):$(".reduce").css({background:"#fbfbfb",cursor:"not-allowed"});$(".CountNum").html(Parameters.BuyCount);i=0;i=ProductObj?ProductObj.Product.SalePrice:9.99;$(".TotlePrice span").eq(1).html("$"+(Number(i)*Number($(".CountNum").html())).toFixed(2))})},BuyClick:function(n){(n.preventDefault(),n.stopPropagation(),Parameters.clickCheck)&&$.when(POP.CheckLogin()).done(function(){BindEvent.Buy()}).fail(function(){POP.ShowLogin(function(){BindEvent.Buy()})})},Buy:function(){try{fbq&&fbq("track","BuyNow",{resourceID:[Parameters.BGID],productID:[Cookies.get("FinalProductId")]})}catch(t){}ConfirmFlag=!1;var n="token="+Cookies.get("TOKEN")+'&json={BackgroundName:"'+Parameters.BGID+'02",Heads:'+JSON.stringify(Parameters.Heads)+",GrayStyle:1}";CallAjax(MomentCam.urls.syncOrderDataUrl,n,function(n){n.StatusCode==4363441?(Parameters.DataUID=n.DataUID,Cookies.set("isRenderProduct",Parameters.isRenderProduct),Cookies.set("Parameters",Parameters.virtualObj),Cookies.set("ProductImg",$("[name='renderResult']").attr("src")),Cookies.set("FinalProductId",Parameters.FinalProductId),Cookies.set("CartoonCode",Parameters.BGID),Cookies.set("DataUid",Parameters.DataUID),location.href="order.html?v="+Math.random()):POP.Alert("Network unaliable, please try again")})}};(function(){var t={init:function(){function i(){$(".CameraTips").hide();$(".cameraCover").show();$(".cameraBox").animate({top:"0"},300);document.getElementById("snap").addEventListener("click",function(){t.style.visibility="hidden";$("#canvasCemara").css("visibility","visible");canvas=document.getElementById("canvasCemara");ctx=canvas.getContext("2d");var i=520,r=520;t.videoWidth>0&&(r=t.videoHeight/(t.videoWidth/i));canvas.setAttribute("width",i);canvas.setAttribute("height",r);ctx.fillRect(0,0,i,r);ctx.drawImage(t,0,0,i,r);$(".resetButton").show();$(".shootButton").hide();$("#reset").off("click").on("click",function(){$(".resetButton").hide();$(".shootButton").show();t.style.visibility="visible";$("#canvasCemara").css("visibility","hidden")});$("#confirm").off("click").on("click",function(){$(".cameraCover").hide();$(".cameraBox").css("top","-600px");n.handleImageCatch("shoot")})})}$(".partOneRight .PicShow .showBox").hide();$(".cameraBox").show();var t=document.getElementById("v");$(".CameraTips").show();navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0}).then(function(n){t.src=window.URL.createObjectURL(n);t.play()}):navigator.getUserMedia?navigator.getUserMedia({video:!0},function(n){t.src=n;t.play()},errBack):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia({video:!0},function(n){t.src=window.webkitURL.createObjectURL(n);t.play()},errBack):navigator.mozGetUserMedia&&navigator.mozGetUserMedia({video:!0},function(n){t.src=window.URL.createObjectURL(n);t.play()},errBack);i()}},n={init:function(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia)$(".cameraShoot").on("click",t.init);else $(".cameraShoot img").attr("../img/Upload/icon_camera_grey.png"),$(".cameraShoot").css("cursor","not-allowed");this.EventBind()},EventBind:function(){var r=this,i=$(".showBox"),t=$("#file");i.on("click",function(){t.trigger("click")}).on("dragover",function(n){n.preventDefault();n.stopPropagation()}).on("drop",function(n){n.preventDefault();n.stopPropagation();t.trigger("change",n.originalEvent.dataTransfer.files)});$(".uloadPhoto").on("click",function(){$(".CameraTips,.cameraBox").hide();$(".showBox").show();t.trigger("click")});t.on("change",function(t,i){if(document.getElementById("file").files.length!=0){POP.ShowLoading();var r=document.getElementById("file").files[0]||i;n.handleImageCatch("upload",r)}});$(".cameraClose").on("click",function(){$(".cameraCover").hide();$(".cameraBox").css("top","-600px")})},handleImageCatch:function(n,t){var i=this;GetUploadImage(t,n,function(n){try{document.getElementById("file").value=""}catch(i){}if(POP.CloseLoading(),n.StatusCode=="0"){var t=n.Files[0].FileUrl.replace("square-ali.manboker.com","square.oss-cn-hangzhou.aliyuncs.com").replace("production-us.manboker.com","moman-production-us.manboker.com");CallAjax(MomentCam.urls.getFaceUidUrl,"url="+t+"&useruid=0&platform=h5&language=zh",function(n){n.StatusCode==-4363402?POP.Alert("It seems there was an issue with the picture you used. Please try using a different picture!"):n.FaceUID==""?(POP.Alert("Upload picture failed, Please upload again!"),POP.displayControl(0)):(POP.displayControl(1),localStorage.setItem("faceuid",n.FaceUID),localStorage.setItem("offsetY",n.FaceOffsetY),window.location.href="beauty.html?v="+Math.random())})}})}};window.U=n})(window);